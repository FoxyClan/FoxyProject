<section class="collection">
    <div class="container" [@popIn]>
        <div class="container-block1">
            <div class="title-block">
              <h1>FOXY</h1>
              <p>The 20,000 red pandas, each unique and generated from more than 80 possible traits.</p>
            </div>

            <div class="filter-mobile-container" *ngIf="isFilterModalOpen" (click)="closeFilterModal()">
              <div class="filter-modal-overlay" [ngClass]="filterModalAnimation">
                <div class="filter-modal" (click)="$event.stopPropagation()">
                  <img src="close.png" class="close-btn" alt="close" (click)="closeFilterModal()">
                  <div class="filter-block">
                    <div class="trait-block" *ngFor="let trait of traits; let i = index">
                      <div class="trait" (click)="toggleTrait(i)">
                          <p>{{ trait }}</p>
                          <img [src]="'arrow-down.png'" [class.rotated]="isTraitOpen[i]" alt="arrow icon">
                      </div>
                      <ul *ngIf="trait === 'HEAD COVERING'" class="list-trait" [@slideIn]="isTraitOpen[i] ? 'in' : 'out'">
                        <li *ngFor="let option of traitOptionsService.headCoveringOptions">
                          <input type="checkbox" class="input-option" id="{{ option.name }}" [(ngModel)]="option.selected" (change)="updateSelectedFilters(option.name, 'HEAD COVERING')">
                          <label for="{{ option.name }}">{{ option.name }}</label>
                        </li>
                      </ul>
                      
                      <ul *ngIf="trait === 'MOUTH'" class="list-trait" [@slideIn]="isTraitOpen[i] ? 'in' : 'out'">
                        <li *ngFor="let option of traitOptionsService.mouthOptions">
                          <input type="checkbox" class="input-option" id="{{ option.name }}" [(ngModel)]="option.selected" (change)="updateSelectedFilters(option.name, 'MOUTH')">
                          <label for="{{ option.name }}">{{ option.name }}</label>
                        </li>
                      </ul>
      
                      <ul *ngIf="trait === 'EYES'" class="list-trait" [@slideIn]="isTraitOpen[i] ? 'in' : 'out'">
                        <li *ngFor="let option of traitOptionsService.eyesOptions">
                          <input type="checkbox" class="input-option" id="{{ option.name }}" [(ngModel)]="option.selected" (change)="updateSelectedFilters(option.name, 'EYES')">
                          <label for="{{ option.name }}">{{ option.name }}</label>
                        </li>
                      </ul>
      
                      <ul *ngIf="trait === 'CLOTHES'" class="list-trait" [@slideIn]="isTraitOpen[i] ? 'in' : 'out'">
                        <li *ngFor="let option of traitOptionsService.clothesOptions">
                          <input type="checkbox" class="input-option" id="{{ option.name }}" [(ngModel)]="option.selected" (change)="updateSelectedFilters(option.name, 'CLOTHES')">
                          <label for="{{ option.name }}">{{ option.name }}</label>
                        </li>
                      </ul>
      
                      <ul *ngIf="trait === 'FUR'" class="list-trait" [@slideIn]="isTraitOpen[i] ? 'in' : 'out'">
                        <li *ngFor="let option of traitOptionsService.furOptions">
                          <input type="checkbox" class="input-option" id="{{ option.name }}" [(ngModel)]="option.selected" (change)="updateSelectedFilters(option.name, 'FUR')">
                          <label for="{{ option.name }}">{{ option.name }}</label>
                        </li>
                      </ul>
      
                      <ul *ngIf="trait === 'BACKGROUND'" class="list-trait" [@slideIn]="isTraitOpen[i] ? 'in' : 'out'">
                        <li *ngFor="let option of traitOptionsService.backgroundOptions">
                          <input type="checkbox" class="input-option" id="{{ option.name }}" [(ngModel)]="option.selected" (change)="updateSelectedFilters(option.name, 'BACKGROUND')">
                          <label for="{{ option.name }}">{{ option.name }}</label>
                        </li>
                      </ul>
      
                      <ul *ngIf="trait === 'TRANSCENDENCE'" class="list-trait" [@slideIn]="isTraitOpen[i] ? 'in' : 'out'">
                        <li *ngFor="let option of traitOptionsService.transcendenceOptions">
                          <input type="checkbox" class="input-option" id="{{ option.name }}" [(ngModel)]="option.selected" (change)="updateSelectedFilters(option.name, 'TRANSCENDENCE')">
                          <label for="{{ option.name }}">{{ option.name }}</label>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="mobile-filter-header">
              <button class="open-filter-btn" (click)="openFilterModal()">Filters</button>
              <div class="selected-filters" *ngIf="selectedFilters.length > 0">
                <div class="filter-tag" *ngFor="let filter of selectedFilters" (click)="removeFilter(filter)">
                  {{ filter.value }}
                  <span class="remove-filter">&#10005;</span>
                </div>
                <span class="clear-filters" (click)="clearAllFilters()">
                  <i class="fas fa-trash-alt"></i>
                </span>
              </div>
            </div>

            <div class="filter-block filters">
              <div class="trait-block" *ngFor="let trait of traits; let i = index">
                <div class="trait" (click)="toggleTrait(i)">
                    <p>{{ trait }}</p>
                    <img [src]="'arrow-down.png'" [class.rotated]="isTraitOpen[i]" alt="arrow icon">
                </div>
                <ul *ngIf="trait === 'HEAD COVERING'" class="list-trait" [@slideIn]="isTraitOpen[i] ? 'in' : 'out'">
                  <li *ngFor="let option of traitOptionsService.headCoveringOptions">
                    <input type="checkbox" class="input-option" id="{{ option.name }}" [(ngModel)]="option.selected" (change)="updateSelectedFilters(option.name, 'HEAD COVERING')">
                    <label for="{{ option.name }}">{{ option.name }}</label>
                  </li>
                </ul>
                
                <ul *ngIf="trait === 'MOUTH'" class="list-trait" [@slideIn]="isTraitOpen[i] ? 'in' : 'out'">
                  <li *ngFor="let option of traitOptionsService.mouthOptions">
                    <input type="checkbox" class="input-option" id="{{ option.name }}" [(ngModel)]="option.selected" (change)="updateSelectedFilters(option.name, 'MOUTH')">
                    <label for="{{ option.name }}">{{ option.name }}</label>
                  </li>
                </ul>

                <ul *ngIf="trait === 'EYES'" class="list-trait" [@slideIn]="isTraitOpen[i] ? 'in' : 'out'">
                  <li *ngFor="let option of traitOptionsService.eyesOptions">
                    <input type="checkbox" class="input-option" id="{{ option.name }}" [(ngModel)]="option.selected" (change)="updateSelectedFilters(option.name, 'EYES')">
                    <label for="{{ option.name }}">{{ option.name }}</label>
                  </li>
                </ul>

                <ul *ngIf="trait === 'CLOTHES'" class="list-trait" [@slideIn]="isTraitOpen[i] ? 'in' : 'out'">
                  <li *ngFor="let option of traitOptionsService.clothesOptions">
                    <input type="checkbox" class="input-option" id="{{ option.name }}" [(ngModel)]="option.selected" (change)="updateSelectedFilters(option.name, 'CLOTHES')">
                    <label for="{{ option.name }}">{{ option.name }}</label>
                  </li>
                </ul>

                <ul *ngIf="trait === 'FUR'" class="list-trait" [@slideIn]="isTraitOpen[i] ? 'in' : 'out'">
                  <li *ngFor="let option of traitOptionsService.furOptions">
                    <input type="checkbox" class="input-option" id="{{ option.name }}" [(ngModel)]="option.selected" (change)="updateSelectedFilters(option.name, 'FUR')">
                    <label for="{{ option.name }}">{{ option.name }}</label>
                  </li>
                </ul>

                <ul *ngIf="trait === 'BACKGROUND'" class="list-trait" [@slideIn]="isTraitOpen[i] ? 'in' : 'out'">
                  <li *ngFor="let option of traitOptionsService.backgroundOptions">
                    <input type="checkbox" class="input-option" id="{{ option.name }}" [(ngModel)]="option.selected" (change)="updateSelectedFilters(option.name, 'BACKGROUND')">
                    <label for="{{ option.name }}">{{ option.name }}</label>
                  </li>
                </ul>

                <ul *ngIf="trait === 'TRANSCENDENCE'" class="list-trait" [@slideIn]="isTraitOpen[i] ? 'in' : 'out'">
                  <li *ngFor="let option of traitOptionsService.transcendenceOptions">
                    <input type="checkbox" class="input-option" id="{{ option.name }}" [(ngModel)]="option.selected" (change)="updateSelectedFilters(option.name, 'TRANSCENDENCE')">
                    <label for="{{ option.name }}">{{ option.name }}</label>
                  </li>
                </ul>
              </div>
            </div>
        </div>


        <div class="container-block2" #containerBlock2>
          <div class="no-result" *ngIf="tokens.length === 0">
            <div *ngIf="isLoading" class="spinner"></div>
            <p *ngIf="!isLoading">No result</p>
          </div>
          
          <div class="block2">
            <ul class="block2-list" *ngIf="tokens.length > 0">
              <li *ngFor="let token of tokens" class="block2-li">
                <div class="block2-div">
                  <a class="block2-a">
                    <img class="block2-img" [src]="'https://foxyclan.s3.filebase.com/' + token?.tokenId + '.png' + '?t=' + cacheVersion" alt="" (click)="openModal(token)">
                  </a>
                  <p>#{{ token.tokenId }}</p>
                </div>
              </li>
            </ul>
          </div>
        
          <div>
            <div *ngIf="isLoading && tokenIndex >= 20" class="spinner"></div>
          </div>
          
        </div>
    </div>
</section>

<app-modal-collection *ngIf="showModal" [token]="selectedToken" (closeModalEvent)="closeModal()"></app-modal-collection>
